# JWT(Json Web Token)

+ JWT란 인증에 필요한 정보들을 암호화 시킨 JSON 토큰을 의미
+ JWT 기반 인증은 JWT(Access Token)을 HTTP 헤더에 실어 서버가 클라이언트를 식별하는 방식
+ JWT는 JSON 데이터를 Base64 URL-safe Encode를 통해 인코딩하여 직렬화한 것
+ 토큰 내부에는 위변조 방지를 위해 개인키를 통한 전자서명도 들어있다. 따라서, JWT를 서버로 전송하면 서버는 서명을 검증하는 과정을 거치게 되며 검증이 완료되면 요청한 응답을 돌려준다.

### 1. JWT 구조
+ JWT는 .을 구분자로 나누어지는 세 가지 문자열의 조합이다.
+ Header.Payload.Signature
### Header: JWT에서 사용할 타입과 알고리즘의 종류
```json
{
    "alg": "HS256",
    "typ": "JWT"
}
```
### Payload: 서버에서 첨부한 사용자 권한 정보와 데이터(실제 JWT를 통해서 알 수 있는 데이터)
```json
{
    "sub":"123456789",
    "name":"John Doe",
    "iat":1516239022
}
```
+ payload는 정해진 데이터 타입은 없지만 대표적으로 다음 세가지로 나눈다.
1. Registed claims : 미리 정의된 클레임.
+ iss(issuer; 발행자),
+ exp(expireation time; 만료 시간),
+ sub(subject; 제목),
+ iat(issued At; 발행 시간),
+ jti(JWI ID)
2. Public claims : 사용자가 정의할 수 있는 클레임 공개용 정보 전달을 위해 사용.
3. Private claims : 해당하는 당사자들 간에 정보를 공유하기 위해 만들어진 사용자 지정 클레임. 외부에 공개되도 상관없지만 해당 유저를 특정할 수 있는 정보들을 담는다

### Signature: 전자서명(비대칭 암호화 알고리즘)
+ 시그니처에서 사용하는 알고리즘은 헤더에서 정의한 알고리즘 방식(alg)을 활용한다.
+ 시그니처의 구조는 (헤더 + 페이로드)와 서버가 갖고 있는 유일한 key 값을 합친 것을 헤더에서 정의한 알고리즘으로 암호화를 한다.

### 2. JWT를 이용한 인증 과정
1. 클라이언트->서버 : 아이디와 비밀번호로 로그인함
+ 사용자가 ID,PW를 입력하여 서버에 로그인 인증을 요청
2. 서버->클라이언트 : JWT, Access Token, Refresh Token 발급
+ 서버가 클라이언트로 부터 인증요청을 받으면 Header, Payload, Signature를 정의
+ Header, Payload, Signature를 Base64로 한 번 더 암호화하여 JWT를 생성하고 이를 쿠키에 담아 클라이언트에게 발급
3. 클라이언트->서버 : Access Token을 사용하여 API요청
+ 클라이언트는 서버로부터 받은 JWT를 로컬스토리지에 저장(혹은 쿠키)
+ API를 서버에 요청할 때, <b>Authorization header에 Access Token을 담아서 보낸다.</b>
4. 서버->클라이언트 : Access Token에 문제가 없으면 정보 응답
+ 클라이언특가 Header에 담아서 보낸 JWT가 내 서버에서 발행한 토큰인지 일치여부 확인 후 통과 시킴
+ 인증이 통과되면 페이로드에 들어있는 유저의 정보를 select해서 클라이언트에게 돌려준다
5. 클라이언트->서버 : Refresh Token으로 Access Token 재발급
+ 클라이언트가 서버에 요청을 했는데, 만일 액세스 토큰의 시간이 만료되면 클라이언트는 Refresh Token을 이용해서  Access Token 재발급받는다.
6. 서버->클라이언트 : Access Token 재발급
+ 서버로부터 새로운 엑세스 토큰을 발급 받는다.

### 3. JWT 장점
1. 헤더와 페이로드를 가지고 시그니처를 생성하므로 데이터 위변조를 막을 수 있다.
2. 인증 정보에 대한 별도의 저장소가 필요없다.
3. 토큰에 대한 기본 정보와 전달할 정보 및 토큰이 검증됐음을 증명하는 서명 등 필요한 정보를 자체적으로 지니고 있다
4. 클라이언트 인증 정보를 저장하는 세션과 다르게, 서버는 무상태가 되어 확장성이 우수해질 수 있다.
5. 토큰 기반으로 다른 로그인 시스템에 접근 및 권한 공유가 가능하다.(쿠키와 차이)
6. DB조회를 안해도 된다. 페이로드에 유저이름과 유저등급을 같이 두고 보내면, 서버에서는 유저 이름을 가지고 DB를 조회해서 유저등급을 얻지 않아도 바로 원하는 정보를 취득할 수 있다.

### 4. JWT 단점
1. Self-contained : 토큰 자체에 정보를 담고 있으므로 양날의 검이 될 수 있다.
2. 토큰 길이 : 토큰의 Payload에 3종류의 클레임을 저장하기 때문에, 정보가 많아질수록 토큰의 길이가 늘어나 네트워크에 부하를 줄 수 있다.
3. Payload 인코딩 : payload 자체는 암호화 된 것이 아니라 BASE64로 인코딩 된 것이기 때문에, 중간에 Payload를 탈취하여 디코딩하면 데이터를 볼 수 있으므로, payload에 중요 데이터를 넣지 않아야 한다.
4. Store Token : stateless 특징을 가지기 때문에, 토큰은 클라이언트 측에서 관리하고 저장한다. 때문에 토큰 자체를 탈취당하면 대처하기가 어렵게 된다.


[출처]https://inpa.tistory.com/559